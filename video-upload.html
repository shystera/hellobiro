<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload - Kohza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mux/mux-player"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        purple: {
                            DEFAULT: '#9333ea', '50': '#faf5ff', '100': '#f3e8ff', '200': '#e9d5ff', '300': '#d8b4fe', '400': '#c084fc', '500': '#a855f7', '600': '#9333ea', '700': '#7e22ce', '800': '#6b21a8', '900': '#581c87', '950': '#3b0764'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="antialiased bg-black text-gray-100">
    <!-- Background -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10">
        <div class="absolute w-[80vmax] h-[80vmax] -left-[40vmax] -top-[40vmax] bg-purple-900/20 rounded-full blur-3xl opacity-60"></div>
        <div class="absolute w-[60vmax] h-[60vmax] -right-[30vmax] -bottom-[20vmax] bg-purple-800/15 rounded-full blur-3xl opacity-50"></div>
    </div>
    
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-black/80 backdrop-blur-md border-b border-gray-800">
        <nav class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <a href="index.html" class="text-2xl font-serif font-bold text-white">Kohza</a>
                <div class="hidden md:flex items-center gap-1 text-sm text-gray-400">
                    <a href="coach-admin-panel.html" class="hover:text-purple-400 transition-colors">Dashboard</a>
                    <svg class="w-4 h-4 mx-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                    <span>Video Upload</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="p-2 text-gray-400 hover:text-white transition-colors">
                    <svg id="theme-icon-dark" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    <svg id="theme-icon-light" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                </button>
                <div class="flex items-center gap-2">
                    <img src="https://i.pravatar.cc/32?u=coach" alt="Coach" class="w-8 h-8 rounded-full border-2 border-purple-600">
                    <span class="hidden sm:block text-sm font-medium">Dr. Elena Rodriguez</span>
                </div>
            </div>
        </nav>
    </header>

    <div class="max-w-6xl mx-auto px-6 py-8">
        <!-- Header Section -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-serif font-bold text-white mb-4">Upload Course Video</h1>
            <p class="text-gray-400 text-lg">Secure, protected video hosting with advanced analytics</p>
            <div class="flex items-center justify-center gap-6 mt-6 text-sm">
                <div class="flex items-center gap-2 text-green-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    DRM Protected
                </div>
                <div class="flex items-center gap-2 text-green-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Auto Transcoding
                </div>
                <div class="flex items-center gap-2 text-green-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Global CDN
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Upload Section -->
            <div class="lg:col-span-2">
                <!-- Upload Area -->
                <div id="upload-area" class="bg-gray-900/50 border-2 border-dashed border-gray-700 rounded-lg p-12 text-center hover:border-purple-500 transition-colors cursor-pointer">
                    <div id="upload-idle" class="space-y-4">
                        <svg class="w-16 h-16 text-gray-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <div>
                            <h3 class="text-xl font-semibold text-white mb-2">Drop your video here</h3>
                            <p class="text-gray-400 mb-4">or click to browse files</p>
                            <p class="text-sm text-gray-500">Supports MP4, MOV, AVI up to 5GB</p>
                        </div>
                        <button class="bg-purple-700 hover:bg-purple-600 text-white font-medium py-3 px-6 rounded-md transition-colors">
                            Choose File
                        </button>
                    </div>

                    <!-- Upload Progress -->
                    <div id="upload-progress" class="hidden space-y-4">
                        <svg class="w-16 h-16 text-purple-500 mx-auto animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <div>
                            <h3 class="text-xl font-semibold text-white mb-2">Uploading to Mux...</h3>
                            <div class="w-full bg-gray-700 rounded-full h-2 mb-2">
                                <div id="progress-bar" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="progress-text" class="text-gray-400">0% complete</p>
                        </div>
                    </div>

                    <!-- Upload Success -->
                    <div id="upload-success" class="hidden space-y-4">
                        <svg class="w-16 h-16 text-green-500 mx-auto" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <h3 class="text-xl font-semibold text-white mb-2">Upload Complete!</h3>
                            <p class="text-gray-400">Video is processing and will be ready shortly</p>
                        </div>
                    </div>
                </div>

                <!-- Video Details Form -->
                <div id="video-form" class="hidden mt-8 bg-gray-900/50 border border-gray-800 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Video Details</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Title</label>
                            <input type="text" id="video-title" class="w-full bg-gray-800 border border-gray-700 text-white px-3 py-2 rounded-md focus:border-purple-500 focus:outline-none" placeholder="Enter video title">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                            <textarea id="video-description" rows="3" class="w-full bg-gray-800 border border-gray-700 text-white px-3 py-2 rounded-md focus:border-purple-500 focus:outline-none" placeholder="Describe your video content"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Course</label>
                                <select id="video-course" class="w-full bg-gray-800 border border-gray-700 text-white px-3 py-2 rounded-md focus:border-purple-500 focus:outline-none">
                                    <option>Mindful Leadership Mastery</option>
                                    <option>Advanced Communication Skills</option>
                                    <option>Strategic Thinking Workshop</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Lesson</label>
                                <select id="video-lesson" class="w-full bg-gray-800 border border-gray-700 text-white px-3 py-2 rounded-md focus:border-purple-500 focus:outline-none">
                                    <option>Module 1: Introduction</option>
                                    <option>Module 2: Core Concepts</option>
                                    <option>Module 3: Practical Applications</option>
                                </select>
                            </div>
                        </div>
                        <button id="save-video" class="bg-purple-700 hover:bg-purple-600 text-white font-medium py-2 px-6 rounded-md transition-colors">
                            Save Video
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Processing Status -->
                <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
                    <h3 class="font-serif font-semibold text-lg mb-4">Processing Status</h3>
                    <div id="processing-status" class="space-y-3">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <span class="text-gray-400 text-sm">Upload to Mux</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <span class="text-gray-400 text-sm">Video Encoding</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <span class="text-gray-400 text-sm">Thumbnail Generation</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <span class="text-gray-400 text-sm">DRM Protection</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <span class="text-gray-400 text-sm">CDN Distribution</span>
                        </div>
                    </div>
                </div>

                <!-- Video Analytics Preview -->
                <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
                    <h3 class="font-serif font-semibold text-lg mb-4">Analytics Preview</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Views</span>
                            <span class="text-white font-medium">--</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Avg. Watch Time</span>
                            <span class="text-white font-medium">--</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Completion Rate</span>
                            <span class="text-white font-medium">--</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Engagement Score</span>
                            <span class="text-white font-medium">--</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">Analytics available after video processing</p>
                </div>

                <!-- Protection Features -->
                <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-5">
                    <h3 class="font-serif font-semibold text-lg mb-4">Protection Features</h3>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span class="text-gray-300 text-sm">DRM Encryption</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span class="text-gray-300 text-sm">Screenshot Blocking</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span class="text-gray-300 text-sm">Domain Restrictions</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span class="text-gray-300 text-sm">Watermarking</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Uploads -->
        <div class="mt-12">
            <h2 class="text-2xl font-serif font-bold text-white mb-6">Recent Uploads</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Sample video cards -->
                <div class="bg-gray-900/50 border border-gray-800 rounded-lg overflow-hidden hover:border-gray-700 transition-colors">
                    <div class="aspect-video bg-gray-800 relative">
                        <mux-player
                            playback-id="demo-recent-upload"
                            style="width: 100%; height: 100%;"
                            accent-color="#9333ea"
                            controls="false"
                            muted
                            poster="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=225&fit=crop"
                        ></mux-player>
                        <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                            <button class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                                <svg class="w-6 h-6 text-white ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                            </button>
                        </div>
                        <div class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded flex items-center gap-1">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg>
                            Protected
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-white mb-1">Introduction to Mindful Leadership</h3>
                        <p class="text-gray-400 text-sm mb-2">Uploaded 2 hours ago • Mux Asset: mux-abc123...</p>
                        <div class="flex items-center gap-4 text-xs text-gray-500">
                            <span>1,247 views</span>
                            <span>94% completion</span>
                            <span class="text-purple-400">DRM Protected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" accept="video/*" class="hidden">

    <script type="module">
        import { auth, db, utils } from './supabase-client.js';

        // Real Mux integration with Supabase backend
        let currentUser = null;
        let courseData = null;

        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication and role
            const authData = await utils.requireAuth('coach');
            if (!authData) return;

            currentUser = authData.user;
            
            // Get course ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('courseId');
            
            if (courseId) {
                await loadCourseData(courseId);
            }
        });

        // Load course data from Supabase
        async function loadCourseData(courseId) {
            try {
                const { data: modules, error } = await db.getModulesByCourse(courseId);
                if (error) throw error;

                courseData = { id: courseId, modules: modules || [] };
                populateModuleSelect();
            } catch (error) {
                console.error('Error loading course:', error);
                alert('Error loading course data.');
            }
        }

        // Populate module dropdown
        function populateModuleSelect() {
            const moduleSelect = document.getElementById('lesson-module');
            if (courseData && courseData.modules.length > 0) {
                moduleSelect.innerHTML = courseData.modules.map(module => 
                    `<option value="${module.id}">${module.title}</option>`
                ).join('');
            } else {
                moduleSelect.innerHTML = '<option value="">No modules available</option>';
            }
        }

        // DOM elements
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const uploadIdle = document.getElementById('upload-idle');
        const uploadProgress = document.getElementById('upload-progress');
        const uploadSuccess = document.getElementById('upload-success');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const videoForm = document.getElementById('video-form');
        const processingStatus = document.getElementById('processing-status');

        // Upload functionality
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-purple-500');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-purple-500');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-purple-500');
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFileUpload(files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        async function handleFileUpload(file) {
            // Validate file
            if (!file.type.startsWith('video/')) {
                alert('Please select a video file');
                return;
            }

            if (file.size > 5 * 1024 * 1024 * 1024) { // 5GB limit
                alert('File size must be less than 5GB');
                return;
            }

            // Show upload progress
            uploadIdle.classList.add('hidden');
            uploadProgress.classList.remove('hidden');

            try {
                // Step 1: Create Mux upload URL
                progressText.textContent = 'Creating upload URL...';
                const uploadResponse = await createMuxUpload();
                
                if (!uploadResponse.ok) {
                    const errorData = await uploadResponse.text();
                    throw new Error(`Failed to create upload URL: ${errorData}`);
                }

                const uploadData = await uploadResponse.json();
                const uploadUrl = uploadData.data.url;
                const assetId = uploadData.data.asset_id;
                
                console.log('Mux upload created:', { assetId, uploadUrl: uploadUrl.substring(0, 50) + '...' });
                progressText.textContent = 'Starting upload to Mux...';

                // Step 2: Upload file to Mux
                await uploadToMux(file, uploadUrl);

                // Step 3: Show success and form
                uploadProgress.classList.add('hidden');
                uploadSuccess.classList.remove('hidden');
                videoForm.classList.remove('hidden');

                // Update processing status
                updateProcessingStatus();

                // Store asset ID for later use
                window.currentAssetId = assetId;
                
                // Show real asset ID in UI
                const successDiv = uploadSuccess.querySelector('div');
                successDiv.innerHTML = `
                    <h3 class="text-xl font-semibold text-white mb-2">Upload Complete!</h3>
                    <p class="text-gray-400">Video uploaded to Mux successfully</p>
                    <p class="text-sm text-purple-400 mt-2">Asset ID: ${assetId}</p>
                    <p class="text-xs text-gray-500 mt-1">Processing will begin shortly...</p>
                `;

            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed. Please try again.');
                resetUploadState();
            }
        }

        async function createMuxUpload() {
            // Direct Mux API integration - production ready
            const auth = btoa('3171e035-cc96-430d-bf4f-60e8f1da8de2:Z2LXWsPVSl2MYIlg6od/jj+oGKf/IcKlQnfUyYlT38JLRMWlIL0xT1qIMt6Vxi5BHE4lG0nGPhx');
            
            return fetch('https://api.mux.com/video/v1/uploads', {
                method: 'POST',
                headers: {
                    'Authorization': `Basic ${auth}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    new_asset_settings: {
                        playback_policy: ['signed'],
                        encoding_tier: 'baseline'
                    },
                    cors_origin: window.location.origin
                })
            });
        }

        async function uploadToMux(file, uploadUrl) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                
                // Track upload progress
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressBar.style.width = percentComplete + '%';
                        progressText.textContent = Math.round(percentComplete) + '% complete';
                    }
                });

                xhr.addEventListener('load', () => {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        progressText.textContent = '100% complete - Processing...';
                        resolve();
                    } else {
                        reject(new Error(`Upload failed with status: ${xhr.status}`));
                    }
                });

                xhr.addEventListener('error', () => {
                    reject(new Error('Upload failed due to network error'));
                });

                xhr.addEventListener('timeout', () => {
                    reject(new Error('Upload timed out'));
                });

                // Set timeout to 10 minutes
                xhr.timeout = 10 * 60 * 1000;

                // Start the upload
                xhr.open('PUT', uploadUrl);
                xhr.send(file);
            });
        }

        function updateProcessingStatus() {
            const steps = processingStatus.querySelectorAll('.w-2');
            let currentStep = 0;

            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    steps[currentStep].classList.remove('bg-gray-600');
                    steps[currentStep].classList.add('bg-green-500');
                    currentStep++;
                } else {
                    clearInterval(interval);
                }
            }, 1000);
        }

        function resetUploadState() {
            uploadProgress.classList.add('hidden');
            uploadSuccess.classList.add('hidden');
            uploadIdle.classList.remove('hidden');
            videoForm.classList.add('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = '0% complete';
        }

        // Save video details
        document.getElementById('save-video').addEventListener('click', async () => {
            const title = document.getElementById('video-title').value;
            const description = document.getElementById('video-description').value;
            const course = document.getElementById('video-course').value;
            const lesson = document.getElementById('video-lesson').value;

            if (!title) {
                alert('Please enter a video title');
                return;
            }

            // Here you would save to your database (Supabase)
            // For demo purposes, we'll just show success
            alert('Video details saved successfully!');
            
            // Reset form
            resetUploadState();
            document.getElementById('video-title').value = '';
            document.getElementById('video-description').value = '';
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const darkIcon = document.getElementById('theme-icon-dark');
        const lightIcon = document.getElementById('theme-icon-light');
        const htmlEl = document.documentElement;

        function setTheme(theme) {
            htmlEl.setAttribute('data-theme', theme);
            darkIcon.classList.toggle('hidden', theme === 'light');
            lightIcon.classList.toggle('hidden', theme === 'dark');
            localStorage.setItem('theme', theme);
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlEl.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        setTheme(savedTheme);

        // Add light theme styles
        const style = document.createElement('style');
        style.textContent = `
            html[data-theme='light'] body {
                background: #f9fafb;
                color: #1f2937;
            }
            html[data-theme='light'] .fixed.top-0.left-0 {
                display: none;
            }
            html[data-theme='light'] header {
                background-color: rgba(255, 255, 255, 0.9);
                border-color: #e5e7eb;
            }
            html[data-theme='light'] .text-white {
                color: #111827 !important;
            }
            html[data-theme='light'] .text-gray-100 {
                color: #1f2937 !important;
            }
            html[data-theme='light'] .text-gray-300 {
                color: #374151 !important;
            }
            html[data-theme='light'] .text-gray-400 {
                color: #6b7280 !important;
            }
            html[data-theme='light'] .text-gray-500 {
                color: #9ca3af !important;
            }
            html[data-theme='light'] .bg-gray-900\\/50 {
                background-color: rgba(255, 255, 255, 0.8) !important;
                border-color: #e5e7eb !important;
            }
            html[data-theme='light'] .bg-gray-800 {
                background-color: #f3f4f6 !important;
                color: #374151 !important;
            }
            html[data-theme='light'] .border-gray-800 {
                border-color: #e5e7eb !important;
            }
            html[data-theme='light'] .border-gray-700 {
                border-color: #d1d5db !important;
            }
            html[data-theme='light'] .bg-black\\/80 {
                background-color: rgba(255, 255, 255, 0.9) !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>